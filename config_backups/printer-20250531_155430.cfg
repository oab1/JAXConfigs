## Voron V2 - 250mm - Spider v2.2 / Monolith Gantry / HUVUD Toolhead board / Canbus/ Dockable Probe
# NOTES:
# 04/26/25 - switch to Kalico, prepare for Cartographer eddy-current z-probe install

[printer]
kinematics: corexy
max_velocity: 300  
max_accel: 10000
max_z_velocity: 30 			 
max_z_accel: 500   			 
square_corner_velocity: 10.0

[input_shaper]
shaper_freq_x: 75.8
shaper_type_x: mzv
damping_ratio_x: 0.05
shaper_freq_y: 50.8		
shaper_type_y: mzv
damping_ratio_y: 0.041

[idle_timeout]
gcode:
  TURN_OFF_HEATERS
  M84												; turn off stepper motors
  SET_PIN PIN=caselight  VALUE=0 					; turn off lights
  SET_HEATER_TEMPERATURE heater=heater_chamber target=0			; turn off bed fans
  SET_FAN_SPEED FAN=air_cleaner SPEED=0				; turn off nevermore carbon air filter
  SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=rpi_fan TARGET=55
timeout: 1800										; in seconds

[gcode_arcs]
resolution: 0.1

### Hardware configurations:
[include mcu_definitions/mcu_Fysetc_Spider_v2.x.cfg]				; main mcu
[include mcu_definitions/mcu_Huvud_v0.62.cfg]						; toolhead mcu
[include mcu_definitions/Cartographer.cfg]							; eddy-probe 
[include hardware/steppers.cfg]
[include hardware/extruder.cfg]

#################
# 	Bed Heater  #
#################

[heater_bed]
heater_pin: E2_OUT			# to SSR, bed is powered from mains AC!
sensor_type: NTC 100K MGB18-104F39050L32
sensor_pin: BED_TEMPERATURE
##	Adjust Max Power to not overdraw max amperage of SSR (4.0amps) = 
max_power: 0.8
min_temp: 0
max_temp: 120
pwm_cycle_time: 0.02088
control: pid
pid_kp: 58.437
pid_ki: 2.347
pid_kd: 363.769

########################################################################
# 	Accessories (Fans / LED / Air Cleaner / Additional temp sensors)   #
########################################################################

[temperature_fan rpi_fan]
pin: HOST_CONTROLLER_FAN
kick_start_time: 0.5
min_temp: 5
max_temp: 100
target_temp: 55.0
max_speed: 0.95
min_speed: 0
#off_below: 0.2 #deprecated, use min_power
min_power: 0.2
sensor_type: temperature_host
control:pid
pid_Kp: 30.0
pid_Ki: 0.3
pid_Kd: 0

[output_pin caselight]
pin: E0_OUT
pwm: true
value: 0
cycle_time: 0.011
scale: 10

[fan_generic air_cleaner]
pin: FILTER_FAN
kick_start_time: 0.1
cycle_time: 0.01

#Bed Fans - configured as chamber heater for PID control
[heater_generic heater_chamber]
heater_pin: BED_FAN
sensor_type: ATC Semitec 104GT-2
sensor_pin: CHAMBER_TEMPERATURE
max_power: 1.0
control: pid
pid_Kp: 20
pid_Ki: 0.2
pid_Kd: 0
pwm_cycle_time: 0.01
min_temp: -273.15
max_temp: 80

[verify_heater heater_chamber]
max_error: 120
check_gain_time: 120
hysteresis: 50
heating_gain: 1

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 5
max_temp: 85

[adxl345]
cs_pin: scanner:PA3
spi_bus: spi1

[resonance_tester]
accel_chip: adxl345
probe_points: 125,125,15

[shaketune]
result_folder: ~/printer_data/config/ShakeTune_results
number_of_results_to_keep: 4
#keep_raw_csv: False
show_macros_in_webui: True
timeout: 300

############################################################
# 	Probe Config / Homing and Gantry Adjustment Routines   #
############################################################

# [probe]
# speed: 4.0
# lift_speed: 25.0
# samples: 3
# samples_result: average
# sample_retract_dist: 2.0
# samples_tolerance: 0.075
# samples_tolerance_retries: 4
# drop_first_result: True

# [z_calibration]
# nozzle_xy_position: 209, 256
# switch_xy_position: 206, 239.5
# bed_xy_position: 125,125
# switch_offset: 0.35		# 0.35mm for 0.5mm nozzle, 0.39 for 0.4mm nozzle
# offset_margins: -1.0,1.0
# safe_z_height: 15
# speed: 300
# probing_first_fast: true

# [dockable_probe]
# #New params for Kalico:
# check_open_attach: True
# dock_position: 49,256
# approach_position: 49, 206
# detach_position: 89,256
# attach_speed: 50
# detach_speed: 75
# travel_speed: 300
# z_hop: 25
# # Same params as Klipper:
# speed: 4.0
# lift_speed: 25.0
# samples: 3
# samples_result: average
# sample_retract_dist: 2.0
# samples_tolerance: 0.075
# samples_tolerance_retries: 4
# drop_first_result: True

[safe_z_home]
home_xy_position: 214, 256
#home_xy_position: 125, 125 # for cartographer
z_hop: 10
	
[quad_gantry_level]
gantry_corners:
	-60,-10
	310,320
points:
	25, 25
	25, 225 		
	225,225		
	225,25
speed: 300
horizontal_move_z: 15
retries: 5
retry_tolerance: 0.075
max_adjust: 6
use_probe_xy_offsets: True	#Kalico option

[bed_mesh]
speed: 200
horizontal_move_z: 5
mesh_min: 15,15
mesh_max: 235,235
probe_count: 9,9
fade_start: 1.0
fade_end: 10.0
algorithm: bicubic
zero_reference_position: 125,125
#bicubic_tension: 0.2
#split_delta_z: 0.025
#move_check_distance: 5
#mesh_pps: 2,2

###################################
### DO NOT EDIT BELOW THIS LINE ###
###################################
[include fluidd.cfg]
#[include add-ons/klicky-probe/klicky-probe.cfg]
#[include add-ons/adaptive_bed_mesh.cfg]
#[include add-ons/Fysetc_mini12864.cfg]

[include variables.cfg]
[include overrides.cfg]
[include macros/*.cfg]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner model default]
#*# model_coef = 1.2615235416237462,
#*# 	1.6696228319590782,
#*# 	0.7433451402752832,
#*# 	0.33771903839219014,
#*# 	0.49589142924429597,
#*# 	0.6700394095399276,
#*# 	-0.32192370691700434,
#*# 	-0.675980486872186,
#*# 	0.37107378467959434,
#*# 	0.44989361850695464
#*# model_domain = 3.012304128167922e-07,3.3053614815233146e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 32.399372
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.182987, -0.148639, -0.145000, -0.131643, -0.130262, -0.122301, -0.140242, -0.140153, -0.178590
#*# 	-0.118452, -0.088849, -0.085774, -0.077803, -0.071083, -0.081686, -0.091324, -0.091497, -0.117292
#*# 	-0.060555, -0.042383, -0.044947, -0.028830, -0.035609, -0.046548, -0.054796, -0.060010, -0.083418
#*# 	-0.013330, -0.004287, -0.007141, -0.002607, -0.006835, -0.016208, -0.033375, -0.040653, -0.067735
#*# 	-0.005861, 0.007271, 0.002585, 0.011238, 0.000000, -0.010550, -0.027241, -0.033967, -0.067541
#*# 	-0.010129, -0.004621, -0.006609, 0.001372, 0.002929, -0.009503, -0.034755, -0.043456, -0.073961
#*# 	-0.038440, -0.026651, -0.026363, -0.020308, -0.008845, -0.023986, -0.046531, -0.054392, -0.086873
#*# 	-0.098747, -0.072365, -0.070702, -0.067467, -0.065133, -0.064439, -0.081008, -0.086778, -0.115467
#*# 	-0.317370, -0.285389, -0.264470, -0.247249, -0.238604, -0.226875, -0.232849, -0.229229, -0.270800
#*# x_count = 9
#*# y_count = 9
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 235.0
#*# min_y = 15.0
#*# max_y = 235.0
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 5250
#*# scanner_touch_speed = 3
